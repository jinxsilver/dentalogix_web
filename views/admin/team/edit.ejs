<%- include('../partials/header') %>

<div class="card">
  <div class="card-header">
    <h2><%= member ? 'Edit Team Member' : 'Add Team Member' %></h2>
    <div style="display: flex; gap: 0.5rem;">
      <% if (member && member.bio_page_enabled && member.slug) { %>
      <a href="/team/<%= member.slug %>" target="_blank" class="btn btn-primary btn-sm">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
        View Bio Page
      </a>
      <% } %>
      <a href="/admin/team" class="btn btn-secondary">‚Üê Back to Team</a>
    </div>
  </div>

  <div class="card-body">
    <form action="<%= member ? '/admin/team/' + member.id : '/admin/team' %>" method="POST" enctype="multipart/form-data">
      <div class="form-row">
        <div class="form-group">
          <label for="name">Full Name *</label>
          <input type="text" id="name" name="name" required value="<%= member ? member.name : '' %>" placeholder="Dr. Jane Smith">
        </div>

        <div class="form-group">
          <label for="title">Job Title *</label>
          <input type="text" id="title" name="title" value="<%= member ? member.title : '' %>" placeholder="Lead Dentist">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="category">Category *</label>
          <select id="category" name="category">
            <option value="dentist" <%= member && member.category === 'dentist' ? 'selected' : '' %>>Dentist</option>
            <option value="executive" <%= member && member.category === 'executive' ? 'selected' : '' %>>Leadership / Executive</option>
            <option value="hygienist" <%= member && member.category === 'hygienist' ? 'selected' : '' %>>Dental Hygienist</option>
            <option value="staff" <%= (!member || member.category === 'staff' || !member.category) ? 'selected' : '' %>>General Staff</option>
          </select>
        </div>

        <div class="form-group">
          <label for="bio_page_enabled">Bio Page</label>
          <select id="bio_page_enabled" name="bio_page_enabled">
            <option value="0" <%= (!member || !member.bio_page_enabled) ? 'selected' : '' %>>Disabled (Basic info only)</option>
            <option value="1" <%= member && member.bio_page_enabled ? 'selected' : '' %>>Enabled (Clickable detailed bio)</option>
          </select>
          <small style="color: var(--admin-text-secondary); display: block; margin-top: 0.5rem;">
            When enabled, clicking the photo will show a detailed bio page.
          </small>
        </div>
      </div>

      <div class="form-group">
        <label for="bio">Short Biography (shown on About page)</label>
        <textarea id="bio" name="bio" rows="4" placeholder="Brief biography about the team member"><%= member ? member.bio : '' %></textarea>
      </div>

      <div class="form-group">
        <label for="full_bio">Full Biography (shown on individual bio page)</label>
        <textarea id="full_bio" name="full_bio" rows="8" placeholder="Detailed biography for the individual team member page. Only used if Bio Page is enabled."><%= member ? member.full_bio : '' %></textarea>
        <small style="color: var(--admin-text-secondary); display: block; margin-top: 0.5rem;">
          This is displayed on the team member's dedicated bio page. Leave blank to use Short Biography instead.
        </small>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="specialties">Specialties</label>
          <input type="text" id="specialties" name="specialties" value="<%= member ? member.specialties : '' %>" placeholder="Cosmetic Dentistry, Implants">
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" value="<%= member ? member.email : '' %>" placeholder="dr.smith@dentalogix.com">
        </div>
      </div>

      <div class="form-group">
        <label for="credentials">Credentials</label>
        <input type="text" id="credentials" name="credentials" value="<%= member ? member.credentials : '' %>" placeholder="DDS, NYU College of Dentistry">
      </div>

      <div class="form-group">
        <label for="linkedin_url">LinkedIn Profile URL</label>
        <input type="url" id="linkedin_url" name="linkedin_url" value="<%= member ? member.linkedin_url : '' %>" placeholder="https://linkedin.com/in/username">
      </div>

      <h3 style="margin-top: 2rem; margin-bottom: 1rem; color: var(--admin-text-primary);">Education</h3>

      <div class="form-row">
        <div class="form-group">
          <label for="grad_school">Graduate School</label>
          <input type="text" id="grad_school" name="grad_school" value="<%= member ? member.grad_school : '' %>" placeholder="NYU College of Dentistry">
        </div>
        <div class="form-group">
          <label for="grad_degree">Graduate Degree</label>
          <input type="text" id="grad_degree" name="grad_degree" value="<%= member ? member.grad_degree : '' %>" placeholder="Doctor of Dental Surgery (DDS)">
        </div>
      </div>

      <div class="form-group">
        <label>Graduate School Logo</label>
        <% if (member && member.grad_logo) { %>
          <div class="logo-preview" style="margin-bottom: 0.75rem; padding: 0.5rem; background: #f5f5f5; border-radius: 8px; display: inline-block;">
            <img src="<%= member.grad_logo %>" alt="Grad logo" style="height: 50px; width: auto; max-width: 150px; object-fit: contain;">
            <% if (member.grad_logo.startsWith('/uploads/')) { %>
              <div style="font-size: 0.75rem; color: #666; margin-top: 0.25rem;">Uploaded file</div>
            <% } %>
          </div>
        <% } %>
        <div class="logo-input-group" style="display: flex; flex-direction: column; gap: 0.5rem;">
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <input type="text" id="grad_logo" name="grad_logo" value="<%= (member && member.grad_logo && member.grad_logo.startsWith('http')) ? member.grad_logo : '' %>" placeholder="Paste logo URL (https://...)">
          </div>
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <span style="color: var(--admin-text-secondary); font-size: 0.85rem;">or</span>
            <input type="file" id="grad_logo_file" name="grad_logo_file" accept="image/*" style="flex: 1;">
          </div>
        </div>
        <small style="color: var(--admin-text-secondary); display: block; margin-top: 0.5rem;">Upload or paste URL. Logos will be displayed at 100x100px.</small>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="undergrad_school">Undergraduate School</label>
          <input type="text" id="undergrad_school" name="undergrad_school" value="<%= member ? member.undergrad_school : '' %>" placeholder="University at Buffalo">
        </div>
        <div class="form-group">
          <label for="undergrad_degree">Undergraduate Degree</label>
          <input type="text" id="undergrad_degree" name="undergrad_degree" value="<%= member ? member.undergrad_degree : '' %>" placeholder="Bachelor of Science in Biology">
        </div>
      </div>

      <div class="form-group">
        <label>Undergraduate School Logo</label>
        <% if (member && member.undergrad_logo) { %>
          <div class="logo-preview" style="margin-bottom: 0.75rem; padding: 0.5rem; background: #f5f5f5; border-radius: 8px; display: inline-block;">
            <img src="<%= member.undergrad_logo %>" alt="Undergrad logo" style="height: 50px; width: auto; max-width: 150px; object-fit: contain;">
            <% if (member.undergrad_logo.startsWith('/uploads/')) { %>
              <div style="font-size: 0.75rem; color: #666; margin-top: 0.25rem;">Uploaded file</div>
            <% } %>
          </div>
        <% } %>
        <div class="logo-input-group" style="display: flex; flex-direction: column; gap: 0.5rem;">
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <input type="text" id="undergrad_logo" name="undergrad_logo" value="<%= (member && member.undergrad_logo && member.undergrad_logo.startsWith('http')) ? member.undergrad_logo : '' %>" placeholder="Paste logo URL (https://...)">
          </div>
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <span style="color: var(--admin-text-secondary); font-size: 0.85rem;">or</span>
            <input type="file" id="undergrad_logo_file" name="undergrad_logo_file" accept="image/*" style="flex: 1;">
          </div>
        </div>
        <small style="color: var(--admin-text-secondary); display: block; margin-top: 0.5rem;">Upload or paste URL. Logos will be displayed at 100x100px.</small>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="sort_order">Sort Order</label>
          <input type="number" id="sort_order" name="sort_order" value="<%= member ? member.sort_order : 0 %>">
        </div>

        <div class="form-group">
          <label for="status">Status</label>
          <select id="status" name="status">
            <option value="published" <%= (!member || member.status === 'published') ? 'selected' : '' %>>Published</option>
            <option value="draft" <%= member && member.status === 'draft' ? 'selected' : '' %>>Draft</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="photo">Photo</label>
        <% if (member && member.photo) { %>
          <div class="file-preview" style="margin-bottom: 1rem;">
            <img src="<%= member.photo %>" alt="Current photo" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover;">
          </div>
        <% } %>
        <input type="file" id="photo" name="photo" accept="image/*">
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary"><%= member ? 'Update Member' : 'Add Member' %></button>
        <a href="/admin/team" class="btn btn-secondary">Cancel</a>
      </div>
    </form>
  </div>
</div>

<%- include('../partials/footer') %>
