<%- include('../../partials/header', { title, settings, user, currentPath: '/admin/marketing/leads', unreadCount: 0, newLeadsCount }) %>

<div class="page-header">
  <div>
    <a href="/admin/marketing/leads" class="btn btn-secondary btn-sm" style="margin-bottom: 0.5rem;">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
      Back to Leads
    </a>
    <h2>Lead Details</h2>
  </div>
  <form action="/admin/marketing/leads/<%= lead.id %>/delete" method="POST" onsubmit="return confirm('Are you sure you want to delete this lead?')">
    <button type="submit" class="btn btn-danger">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
      Delete Lead
    </button>
  </form>
</div>

<div class="content-grid" style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
  <!-- Lead Information -->
  <div>
    <div class="card">
      <div class="card-header">
        <h3>Contact Information</h3>
      </div>
      <div class="card-body">
        <div class="info-grid" style="display: grid; gap: 1rem;">
          <div class="info-item">
            <label style="font-size: 0.8rem; color: #6B7280; text-transform: uppercase; letter-spacing: 0.05em;">Name</label>
            <div style="font-size: 1.1rem; font-weight: 500;"><%= lead.name %></div>
          </div>

          <% if (lead.email) { %>
          <div class="info-item">
            <label style="font-size: 0.8rem; color: #6B7280; text-transform: uppercase; letter-spacing: 0.05em;">Email</label>
            <div>
              <a href="mailto:<%= lead.email %>" style="color: #0077B6; text-decoration: none;">
                <%= lead.email %>
              </a>
            </div>
          </div>
          <% } %>

          <% if (lead.phone) { %>
          <div class="info-item">
            <label style="font-size: 0.8rem; color: #6B7280; text-transform: uppercase; letter-spacing: 0.05em;">Phone</label>
            <div>
              <a href="tel:<%= lead.phone %>" style="color: #0077B6; text-decoration: none;">
                <%= lead.phone %>
              </a>
            </div>
          </div>
          <% } %>

          <% if (lead.message) { %>
          <div class="info-item">
            <label style="font-size: 0.8rem; color: #6B7280; text-transform: uppercase; letter-spacing: 0.05em;">Message</label>
            <div style="background: #F9FAFB; padding: 1rem; border-radius: 8px; margin-top: 0.5rem;">
              <%= lead.message %>
            </div>
          </div>
          <% } %>
        </div>
      </div>
    </div>

    <% if (lead.utm_source || lead.utm_medium || lead.utm_campaign) { %>
    <div class="card" style="margin-top: 1.5rem;">
      <div class="card-header">
        <h3>Campaign Information</h3>
      </div>
      <div class="card-body">
        <div class="info-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
          <% if (lead.utm_source) { %>
          <div class="info-item">
            <label style="font-size: 0.8rem; color: #6B7280; text-transform: uppercase;">Source</label>
            <div><%= lead.utm_source %></div>
          </div>
          <% } %>
          <% if (lead.utm_medium) { %>
          <div class="info-item">
            <label style="font-size: 0.8rem; color: #6B7280; text-transform: uppercase;">Medium</label>
            <div><%= lead.utm_medium %></div>
          </div>
          <% } %>
          <% if (lead.utm_campaign) { %>
          <div class="info-item">
            <label style="font-size: 0.8rem; color: #6B7280; text-transform: uppercase;">Campaign</label>
            <div><%= lead.utm_campaign %></div>
          </div>
          <% } %>
        </div>
      </div>
    </div>
    <% } %>

    <!-- Update Status -->
    <div class="card" style="margin-top: 1.5rem;">
      <div class="card-header">
        <h3>Update Status</h3>
      </div>
      <div class="card-body">
        <form action="/admin/marketing/leads/<%= lead.id %>/status" method="POST">
          <div class="form-group">
            <label for="status">Status</label>
            <select id="status" name="status">
              <option value="new" <%= lead.status === 'new' ? 'selected' : '' %>>New</option>
              <option value="contacted" <%= lead.status === 'contacted' ? 'selected' : '' %>>Contacted</option>
              <option value="qualified" <%= lead.status === 'qualified' ? 'selected' : '' %>>Qualified</option>
              <option value="converted" <%= lead.status === 'converted' ? 'selected' : '' %>>Converted</option>
              <option value="lost" <%= lead.status === 'lost' ? 'selected' : '' %>>Lost</option>
            </select>
          </div>
          <div class="form-group">
            <label for="notes">Notes</label>
            <textarea id="notes" name="notes" rows="3" placeholder="Add notes about this lead..."><%= lead.notes || '' %></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Update Status</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Sidebar -->
  <div>
    <div class="card">
      <div class="card-header">
        <h3>Status</h3>
      </div>
      <div class="card-body" style="text-align: center;">
        <% if (lead.status === 'new') { %>
          <span class="badge badge-danger" style="font-size: 1rem; padding: 0.5rem 1rem;">New</span>
        <% } else if (lead.status === 'contacted') { %>
          <span class="badge badge-warning" style="font-size: 1rem; padding: 0.5rem 1rem;">Contacted</span>
        <% } else if (lead.status === 'converted') { %>
          <span class="badge badge-success" style="font-size: 1rem; padding: 0.5rem 1rem;">Converted</span>
        <% } else if (lead.status === 'qualified') { %>
          <span class="badge badge-info" style="font-size: 1rem; padding: 0.5rem 1rem;">Qualified</span>
        <% } else if (lead.status === 'lost') { %>
          <span class="badge badge-secondary" style="font-size: 1rem; padding: 0.5rem 1rem;">Lost</span>
        <% } else { %>
          <span class="badge badge-secondary" style="font-size: 1rem; padding: 0.5rem 1rem;"><%= lead.status %></span>
        <% } %>
      </div>
    </div>

    <div class="card" style="margin-top: 1rem;">
      <div class="card-header">
        <h3>Source</h3>
      </div>
      <div class="card-body">
        <div class="info-item" style="margin-bottom: 1rem;">
          <label style="font-size: 0.8rem; color: #6B7280; text-transform: uppercase;">Offer</label>
          <div>
            <% if (lead.offer_title) { %>
              <a href="/admin/marketing/offers/<%= lead.offer_id %>/edit" style="color: #0077B6;"><%= lead.offer_title %></a>
            <% } else { %>
              <span class="text-muted">Direct submission</span>
            <% } %>
          </div>
        </div>
        <div class="info-item">
          <label style="font-size: 0.8rem; color: #6B7280; text-transform: uppercase;">Source Type</label>
          <div><%= lead.source || 'landing_page' %></div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top: 1rem;">
      <div class="card-header">
        <h3>Timeline</h3>
      </div>
      <div class="card-body">
        <div class="info-item">
          <label style="font-size: 0.8rem; color: #6B7280; text-transform: uppercase;">Submitted</label>
          <div><%= new Date(lead.created_at).toLocaleString('en-US', { dateStyle: 'medium', timeStyle: 'short' }) %></div>
        </div>
      </div>
    </div>

    <% if (lead.ip_address || lead.user_agent) { %>
    <div class="card" style="margin-top: 1rem;">
      <div class="card-header">
        <h3>Technical Info</h3>
      </div>
      <div class="card-body">
        <% if (lead.ip_address) { %>
        <div class="info-item" style="margin-bottom: 0.5rem;">
          <label style="font-size: 0.75rem; color: #9CA3AF;">IP Address</label>
          <div style="font-size: 0.85rem; color: #6B7280;"><%= lead.ip_address %></div>
        </div>
        <% } %>
        <% if (lead.user_agent) { %>
        <div class="info-item">
          <label style="font-size: 0.75rem; color: #9CA3AF;">User Agent</label>
          <div style="font-size: 0.75rem; color: #9CA3AF; word-break: break-all;"><%= lead.user_agent %></div>
        </div>
        <% } %>
      </div>
    </div>
    <% } %>

    <!-- Quick Actions -->
    <div class="card" style="margin-top: 1rem;">
      <div class="card-header">
        <h3>Quick Actions</h3>
      </div>
      <div class="card-body">
        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
          <% if (lead.email) { %>
          <a href="mailto:<%= lead.email %>" class="btn btn-secondary btn-sm" style="justify-content: flex-start;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-right: 8px;"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
            Send Email
          </a>
          <% } %>
          <% if (lead.phone) { %>
          <a href="tel:<%= lead.phone %>" class="btn btn-secondary btn-sm" style="justify-content: flex-start;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-right: 8px;"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/></svg>
            Call Now
          </a>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('../../partials/footer') %>
