<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= typeof title !== 'undefined' ? title + ' | ' : '' %><%= settings.site_name || 'Dentalogix' %></title>
  <meta name="description" content="<%= typeof metaDescription !== 'undefined' ? metaDescription : settings.site_tagline %>">

  <!-- Canonical URL -->
  <link rel="canonical" href="<%= settings.site_url || 'https://dentalogix.us' %><%= typeof currentPath !== 'undefined' ? currentPath : '' %>">

  <!-- Open Graph Tags -->
  <meta property="og:title" content="<%= typeof title !== 'undefined' ? title + ' | ' : '' %><%= settings.site_name || 'Dentalogix' %>">
  <meta property="og:description" content="<%= typeof metaDescription !== 'undefined' ? metaDescription : settings.site_tagline %>">
  <meta property="og:type" content="<%= typeof ogType !== 'undefined' ? ogType : 'website' %>">
  <meta property="og:url" content="<%= settings.site_url || 'https://dentalogix.us' %><%= typeof currentPath !== 'undefined' ? currentPath : '' %>">
  <meta property="og:image" content="<%= typeof ogImage !== 'undefined' ? ogImage : (settings.site_logo || (settings.site_url || 'https://dentalogix.us') + '/images/og-default.jpg') %>">
  <meta property="og:site_name" content="<%= settings.site_name || 'Dentalogix' %>">
  <meta property="og:locale" content="en_US">

  <!-- Twitter Card Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="<%= typeof title !== 'undefined' ? title + ' | ' : '' %><%= settings.site_name || 'Dentalogix' %>">
  <meta name="twitter:description" content="<%= typeof metaDescription !== 'undefined' ? metaDescription : settings.site_tagline %>">
  <meta name="twitter:image" content="<%= typeof ogImage !== 'undefined' ? ogImage : (settings.site_logo || (settings.site_url || 'https://dentalogix.us') + '/images/og-default.jpg') %>">

  <!-- Additional SEO -->
  <meta name="robots" content="index, follow">
  <meta name="author" content="<%= settings.site_name || 'Dentalogix' %>">

  <link rel="stylesheet" href="/css/style.css">
  <% if (settings.favicon) { %>
    <link rel="icon" href="<%= settings.favicon %>">
  <% } else { %>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <% } %>

  <!-- LocalBusiness Schema.org JSON-LD -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Dentist",
    "name": "<%= settings.site_name || 'Dentalogix' %>",
    "description": "<%= settings.site_tagline || 'Professional dental care for the whole family' %>",
    "url": "<%= settings.site_url || 'https://dentalogix.us' %>",
    "telephone": "<%= settings.phone || '' %>",
    "email": "<%= settings.email || '' %>",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "<%= settings.address || '2233 W Seneca St' %>",
      "addressLocality": "<%= settings.city || 'Buffalo' %>",
      "addressRegion": "<%= settings.state || 'NY' %>",
      "postalCode": "<%= settings.zip || '14210' %>",
      "addressCountry": "US"
    },
    "geo": {
      "@type": "GeoCoordinates",
      "latitude": "<%= settings.latitude || '42.8864' %>",
      "longitude": "<%= settings.longitude || '-78.8784' %>"
    },
    "openingHoursSpecification": [
      {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
        "opens": "09:00",
        "closes": "17:00"
      }
    ],
    "priceRange": "$$",
    "image": "<%= settings.site_logo || '' %>",
    "sameAs": [
      "<%= settings.facebook_url || '' %>",
      "<%= settings.instagram_url || '' %>",
      "<%= settings.twitter_url || '' %>"
    ]
  }
  </script>
</head>
<body class="<%= settings.site_theme && settings.site_theme !== 'normal' ? 'theme-' + settings.site_theme : '' %>">
  <header class="site-header">
    <div class="container">
      <div class="header-inner">
        <a href="/" class="logo">
          <% if (settings.site_logo) { %>
            <img src="<%= settings.site_logo %>" alt="Dentalogix" class="brand-logo-img">
          <% } else { %>
            <!-- Default SVG logo - Direction 2: Connected Smile -->
            <svg viewBox="0 0 48 48" fill="none" class="brand-logo">
              <defs>
                <linearGradient id="toothGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" class="logo-gradient-start"/>
                  <stop offset="100%" class="logo-gradient-end"/>
                </linearGradient>
              </defs>
              <path d="M24 4c-6 0-11 4-12 10c-1 5 0 10 2 14c1.5 3 3 8 4 12c0.5 2 1.5 3 3 3s2.5-1 3-3c0.5-2 1-4 1.5-6c0.5 2 1 4 1.5 6c0.5 2 1.5 3 3 3s2.5-1 3-3c1-4 2.5-9 4-12c2-4 3-9 2-14c-1-6-6-10-12-10z" fill="url(#toothGradient)" opacity="0.9"/>
              <circle cx="18" cy="14" r="2.5" class="logo-accent"/>
              <circle cx="30" cy="14" r="2.5" class="logo-accent"/>
              <circle cx="24" cy="22" r="3" class="logo-accent"/>
              <circle cx="20" cy="32" r="2" class="logo-accent"/>
              <circle cx="28" cy="32" r="2" class="logo-accent"/>
              <line x1="18" y1="14" x2="24" y2="22" class="logo-line" stroke-width="1" opacity="0.6"/>
              <line x1="30" y1="14" x2="24" y2="22" class="logo-line" stroke-width="1" opacity="0.6"/>
              <line x1="24" y1="22" x2="20" y2="32" class="logo-line" stroke-width="1" opacity="0.6"/>
              <line x1="24" y1="22" x2="28" y2="32" class="logo-line" stroke-width="1" opacity="0.6"/>
              <line x1="18" y1="14" x2="30" y2="14" class="logo-line" stroke-width="1" opacity="0.4"/>
            </svg>
            <span class="logo-text">DENTAL<span>OGIX</span></span>
          <% } %>
        </a>
        
        <nav class="main-nav">
          <ul class="nav-links">
            <%
              // Parse navigation items from settings
              let navItems = [];
              try {
                navItems = JSON.parse(settings.main_nav_links || '[]');
              } catch (e) {
                navItems = [];
              }
              // Default navigation if none configured
              if (navItems.length === 0) {
                navItems = [
                  { label: 'Home', url: '/', visible: true, parent: '' },
                  { label: 'About', url: '/about', visible: true, parent: '' },
                  { label: 'Services', url: '/services', visible: true, parent: '' },
                  { label: 'Locations', url: '/locations', visible: true, parent: '' },
                  { label: 'Mobile Dentistry', url: '/mobile-dentistry', visible: true, parent: '' },
                  { label: 'Blog', url: '/blog', visible: true, parent: '' },
                  { label: 'Contact', url: '/contact', visible: true, parent: '' }
                ];
              }
              // Filter visible items and separate top-level from children
              const visibleItems = navItems.filter(item => item.visible !== false);
              const topLevelItems = visibleItems.filter(item => !item.parent);
              const getChildren = (parentLabel) => visibleItems.filter(item => item.parent === parentLabel);
            %>
            <% topLevelItems.forEach(item => {
              const children = getChildren(item.label);
              const hasChildren = children.length > 0;
              const isActive = currentPath === item.url || (item.url !== '/' && currentPath.startsWith(item.url)) || children.some(child => currentPath === child.url || (child.url !== '/' && currentPath.startsWith(child.url)));
            %>
              <% if (hasChildren) { %>
              <li class="has-dropdown">
                <a href="<%= item.url %>" class="<%= isActive ? 'active' : '' %>">
                  <%= item.label %>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
                </a>
                <ul class="dropdown-menu">
                  <% children.forEach(child => { %>
                  <li><a href="<%= child.url %>" class="<%= currentPath === child.url || (child.url !== '/' && currentPath.startsWith(child.url)) ? 'active' : '' %>"><%= child.label %></a></li>
                  <% }); %>
                </ul>
              </li>
              <% } else { %>
              <li><a href="<%= item.url %>" class="<%= isActive ? 'active' : '' %>"><%= item.label %></a></li>
              <% } %>
            <% }); %>
          </ul>
          
          <div class="header-cta">
            <a href="tel:<%= settings.phone %>" class="header-phone">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/>
              </svg>
              <%= settings.phone %>
            </a>
            <a href="/contact" class="btn btn-primary">Book Appointment</a>
          </div>
        </nav>
        
        <button class="mobile-menu-toggle" aria-label="Toggle menu">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"/>
            <line x1="3" y1="12" x2="21" y2="12"/>
            <line x1="3" y1="18" x2="21" y2="18"/>
          </svg>
        </button>
      </div>
    </div>
  </header>
